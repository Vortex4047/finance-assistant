{% extends "base.html" %}

{% block title %}Goals - Finance Mentor AI{% endblock %}

{% block content %}
<div class="goals-page">
    <div class="container-fluid py-4">
        <!-- Page Header -->
        <div class="page-header mb-4">
            <div class="row align-items-center">
                <div class="col">
                    <h1 class="page-title">
                        <i class="fas fa-bullseye me-3"></i>Financial Goals
                    </h1>
                    <p class="page-subtitle">Track your progress towards financial milestones</p>
                </div>
                <div class="col-auto">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createGoalModal">
                        <i class="fas fa-plus me-2"></i>Create Goal
                    </button>
                </div>
            </div>
        </div>

        <!-- Goals Overview -->
        <div class="row g-4 mb-4">
            <div class="col-lg-3 col-md-6">
                <div class="goal-stat-card card">
                    <div class="card-body">
                        <div class="stat-icon bg-primary">
                            <i class="fas fa-target"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-value">5</h3>
                            <p class="stat-label">Active Goals</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <div class="goal-stat-card card">
                    <div class="card-body">
                        <div class="stat-icon bg-success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-value">2</h3>
                            <p class="stat-label">Completed</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <div class="goal-stat-card card">
                    <div class="card-body">
                        <div class="stat-icon bg-info">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-value">$12,500</h3>
                            <p class="stat-label">Total Saved</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <div class="goal-stat-card card">
                    <div class="card-body">
                        <div class="stat-icon bg-warning">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-content">
                            <h3 class="stat-value">8</h3>
                            <p class="stat-label">Months Avg</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Goals Grid -->
        <div class="row g-4">
            <!-- Emergency Fund Goal -->
            <div class="col-lg-6">
                <div class="goal-card card">
                    <div class="goal-header">
                        <div class="goal-icon bg-danger">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div class="goal-info">
                            <h5 class="goal-title">Emergency Fund</h5>
                            <p class="goal-description">Build a safety net for unexpected expenses</p>
                        </div>
                        <div class="goal-actions">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-edit me-2"></i>Edit</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-plus me-2"></i>Add Funds</a></li>
                                    <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-trash me-2"></i>Delete</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="goal-progress">
                        <div class="progress-info">
                            <div class="current-amount">$3,750</div>
                            <div class="target-amount">/ $10,000</div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress">
                                <div class="progress-bar bg-danger" style="width: 37.5%"></div>
                            </div>
                            <span class="progress-percentage">37.5%</span>
                        </div>
                    </div>
                    
                    <div class="goal-details">
                        <div class="detail-item">
                            <i class="fas fa-calendar text-muted me-2"></i>
                            <span>Target: Dec 2024</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-trending-up text-muted me-2"></i>
                            <span>$520/month needed</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Vacation Goal -->
            <div class="col-lg-6">
                <div class="goal-card card">
                    <div class="goal-header">
                        <div class="goal-icon bg-info">
                            <i class="fas fa-plane"></i>
                        </div>
                        <div class="goal-info">
                            <h5 class="goal-title">Europe Vacation</h5>
                            <p class="goal-description">Two-week trip to Europe next summer</p>
                        </div>
                        <div class="goal-actions">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-edit me-2"></i>Edit</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-plus me-2"></i>Add Funds</a></li>
                                    <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-trash me-2"></i>Delete</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="goal-progress">
                        <div class="progress-info">
                            <div class="current-amount">$4,200</div>
                            <div class="target-amount">/ $6,000</div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress">
                                <div class="progress-bar bg-info" style="width: 70%"></div>
                            </div>
                            <span class="progress-percentage">70%</span>
                        </div>
                    </div>
                    
                    <div class="goal-details">
                        <div class="detail-item">
                            <i class="fas fa-calendar text-muted me-2"></i>
                            <span>Target: Jun 2025</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-trending-up text-muted me-2"></i>
                            <span>$225/month needed</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- House Down Payment -->
            <div class="col-lg-6">
                <div class="goal-card card">
                    <div class="goal-header">
                        <div class="goal-icon bg-success">
                            <i class="fas fa-home"></i>
                        </div>
                        <div class="goal-info">
                            <h5 class="goal-title">House Down Payment</h5>
                            <p class="goal-description">20% down payment for first home</p>
                        </div>
                        <div class="goal-actions">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-edit me-2"></i>Edit</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-plus me-2"></i>Add Funds</a></li>
                                    <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-trash me-2"></i>Delete</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="goal-progress">
                        <div class="progress-info">
                            <div class="current-amount">$15,000</div>
                            <div class="target-amount">/ $50,000</div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress">
                                <div class="progress-bar bg-success" style="width: 30%"></div>
                            </div>
                            <span class="progress-percentage">30%</span>
                        </div>
                    </div>
                    
                    <div class="goal-details">
                        <div class="detail-item">
                            <i class="fas fa-calendar text-muted me-2"></i>
                            <span>Target: Dec 2026</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-trending-up text-muted me-2"></i>
                            <span>$1,458/month needed</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- New Car Goal -->
            <div class="col-lg-6">
                <div class="goal-card card">
                    <div class="goal-header">
                        <div class="goal-icon bg-warning">
                            <i class="fas fa-car"></i>
                        </div>
                        <div class="goal-info">
                            <h5 class="goal-title">New Car</h5>
                            <p class="goal-description">Replace current vehicle</p>
                        </div>
                        <div class="goal-actions">
                            <div class="dropdown">
                                <button class="btn btn-sm btn-outline-secondary" data-bs-toggle="dropdown">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-edit me-2"></i>Edit</a></li>
                                    <li><a class="dropdown-item" href="#"><i class="fas fa-plus me-2"></i>Add Funds</a></li>
                                    <li><a class="dropdown-item text-danger" href="#"><i class="fas fa-trash me-2"></i>Delete</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="goal-progress">
                        <div class="progress-info">
                            <div class="current-amount">$8,500</div>
                            <div class="target-amount">/ $25,000</div>
                        </div>
                        <div class="progress-bar-container">
                            <div class="progress">
                                <div class="progress-bar bg-warning" style="width: 34%"></div>
                            </div>
                            <span class="progress-percentage">34%</span>
                        </div>
                    </div>
                    
                    <div class="goal-details">
                        <div class="detail-item">
                            <i class="fas fa-calendar text-muted me-2"></i>
                            <span>Target: Aug 2025</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-trending-up text-muted me-2"></i>
                            <span>$1,375/month needed</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Goal Insights -->
        <div class="row g-4 mt-4">
            <div class="col-lg-8">
                <div class="card goal-insights-card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-line me-2"></i>Goal Progress Over Time
                        </h5>
                    </div>
                    <div class="card-body">
                        <canvas id="goalProgressChart" height="300"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="card goal-tips-card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-lightbulb me-2"></i>Goal Tips
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="tip-item">
                            <div class="tip-icon bg-success">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="tip-content">
                                <h6>Automate Savings</h6>
                                <p>Set up automatic transfers to reach your goals faster.</p>
                            </div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-icon bg-info">
                                <i class="fas fa-target"></i>
                            </div>
                            <div class="tip-content">
                                <h6>SMART Goals</h6>
                                <p>Make goals Specific, Measurable, Achievable, Relevant, and Time-bound.</p>
                            </div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-icon bg-warning">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                            <div class="tip-content">
                                <h6>Prioritize</h6>
                                <p>Focus on emergency fund first, then other goals.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Goal Modal -->
<div class="modal fade" id="createGoalModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-plus me-2"></i>Create New Goal
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createGoalForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="goalTitle" class="form-label">Goal Title</label>
                                <input type="text" class="form-control" id="goalTitle" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="goalCategory" class="form-label">Category</label>
                                <select class="form-select" id="goalCategory" required>
                                    <option value="">Select category</option>
                                    <option value="Emergency Fund">Emergency Fund</option>
                                    <option value="Vacation">Vacation</option>
                                    <option value="Home">Home Purchase</option>
                                    <option value="Car">Vehicle</option>
                                    <option value="Education">Education</option>
                                    <option value="Retirement">Retirement</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="goalDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="goalDescription" rows="3"></textarea>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="targetAmount" class="form-label">Target Amount</label>
                                <div class="input-group">
                                    <span class="input-group-text">$</span>
                                    <input type="number" class="form-control" id="targetAmount" step="0.01" required>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="targetDate" class="form-label">Target Date</label>
                                <input type="date" class="form-control" id="targetDate" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="currentAmount" class="form-label">Current Amount (Optional)</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="currentAmount" step="0.01" value="0">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="createGoal()">Create Goal</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    initializeGoalChart();
});

function initializeGoalChart() {
    const ctx = document.getElementById('goalProgressChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Emergency Fund',
                data: [1000, 1500, 2200, 2800, 3200, 3750],
                borderColor: '#EF4444',
                backgroundColor: 'rgba(239, 68, 68, 0.1)',
                tension: 0.4
            }, {
                label: 'Vacation',
                data: [500, 1200, 2000, 2800, 3500, 4200],
                borderColor: '#06B6D4',
                backgroundColor: 'rgba(6, 182, 212, 0.1)',
                tension: 0.4
            }, {
                label: 'House Down Payment',
                data: [5000, 7500, 10000, 12000, 13500, 15000],
                borderColor: '#10B981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top'
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '$' + value.toLocaleString();
                        }
                    }
                }
            }
        }
    });
}

function createGoal() {
    const title = document.getElementById('goalTitle').value;
    const category = document.getElementById('goalCategory').value;
    const description = document.getElementById('goalDescription').value;
    const targetAmount = document.getElementById('targetAmount').value;
    const targetDate = document.getElementById('targetDate').value;
    const currentAmount = document.getElementById('currentAmount').value || 0;
    
    if (!title || !category || !targetAmount || !targetDate) {
        alert('Please fill in all required fields');
        return;
    }
    
    fetch('/api/goal', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            title: title,
            category: category,
            description: description,
            target_amount: targetAmount,
            target_date: targetDate,
            current_amount: currentAmount
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            bootstrap.Modal.getInstance(document.getElementById('createGoalModal')).hide();
            location.reload();
        } else {
            alert('Error creating goal: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error creating goal');
    });
}
</script>
{% endblock %}