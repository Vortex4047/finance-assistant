{% extends "base.html" %}

{% block title %}Budgets - Finance Mentor AI{% endblock %}

{% block content %}
<div class="budgets-page">
    <div class="container-fluid py-4">
        <!-- Page Header -->
        <div class="page-header mb-4">
            <div class="row align-items-center">
                <div class="col">
                    <h1 class="page-title">
                        <i class="fas fa-wallet me-3"></i>Budget Management
                    </h1>
                    <p class="page-subtitle">Track and manage your spending limits across categories</p>
                </div>
                <div class="col-auto">
                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createBudgetModal">
                        <i class="fas fa-plus me-2"></i>Create Budget
                    </button>
                </div>
            </div>
        </div>

        <!-- Budget Overview Cards -->
        <div class="row g-4 mb-4">
            <div class="col-lg-3 col-md-6">
                <div class="budget-overview-card card">
                    <div class="card-body">
                        <div class="budget-icon bg-primary">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="budget-content">
                            <h3 class="budget-value">$2,850</h3>
                            <p class="budget-label">Total Budget</p>
                            <div class="budget-progress">
                                <div class="progress">
                                    <div class="progress-bar bg-primary" style="width: 65%"></div>
                                </div>
                                <small class="text-muted">65% used this month</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <div class="budget-overview-card card">
                    <div class="card-body">
                        <div class="budget-icon bg-success">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="budget-content">
                            <h3 class="budget-value">4</h3>
                            <p class="budget-label">On Track</p>
                            <div class="budget-status success">
                                <i class="fas fa-arrow-up"></i>
                                Within budget limits
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <div class="budget-overview-card card">
                    <div class="card-body">
                        <div class="budget-icon bg-warning">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="budget-content">
                            <h3 class="budget-value">2</h3>
                            <p class="budget-label">At Risk</p>
                            <div class="budget-status warning">
                                <i class="fas fa-exclamation-triangle"></i>
                                Over 80% spent
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6">
                <div class="budget-overview-card card">
                    <div class="card-body">
                        <div class="budget-icon bg-danger">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="budget-content">
                            <h3 class="budget-value">1</h3>
                            <p class="budget-label">Over Budget</p>
                            <div class="budget-status danger">
                                <i class="fas fa-arrow-down"></i>
                                Exceeded limit
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Budget Categories -->
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="card budget-categories-card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-list me-2"></i>Budget Categories
                        </h5>
                        <div class="card-actions">
                            <div class="btn-group btn-group-sm" role="group">
                                <button class="btn btn-outline-primary active">All</button>
                                <button class="btn btn-outline-primary">On Track</button>
                                <button class="btn btn-outline-primary">At Risk</button>
                                <button class="btn btn-outline-primary">Over Budget</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- Budget Item -->
                        <div class="budget-item">
                            <div class="budget-item-header">
                                <div class="budget-category">
                                    <div class="category-icon bg-danger">
                                        <i class="fas fa-utensils"></i>
                                    </div>
                                    <div class="category-info">
                                        <h6 class="category-name">Food & Dining</h6>
                                        <p class="category-description">Restaurants, groceries, coffee</p>
                                    </div>
                                </div>
                                <div class="budget-amounts">
                                    <div class="spent-amount">$520</div>
                                    <div class="budget-limit">/ $600</div>
                                </div>
                            </div>
                            <div class="budget-progress-bar">
                                <div class="progress">
                                    <div class="progress-bar bg-warning" style="width: 87%"></div>
                                </div>
                                <div class="progress-info">
                                    <span class="progress-percentage">87%</span>
                                    <span class="remaining-amount">$80 remaining</span>
                                </div>
                            </div>
                        </div>

                        <!-- Budget Item -->
                        <div class="budget-item">
                            <div class="budget-item-header">
                                <div class="budget-category">
                                    <div class="category-icon bg-primary">
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div class="category-info">
                                        <h6 class="category-name">Transportation</h6>
                                        <p class="category-description">Gas, public transit, rideshare</p>
                                    </div>
                                </div>
                                <div class="budget-amounts">
                                    <div class="spent-amount">$180</div>
                                    <div class="budget-limit">/ $300</div>
                                </div>
                            </div>
                            <div class="budget-progress-bar">
                                <div class="progress">
                                    <div class="progress-bar bg-success" style="width: 60%"></div>
                                </div>
                                <div class="progress-info">
                                    <span class="progress-percentage">60%</span>
                                    <span class="remaining-amount">$120 remaining</span>
                                </div>
                            </div>
                        </div>

                        <!-- Budget Item -->
                        <div class="budget-item">
                            <div class="budget-item-header">
                                <div class="budget-category">
                                    <div class="category-icon bg-success">
                                        <i class="fas fa-shopping-bag"></i>
                                    </div>
                                    <div class="category-info">
                                        <h6 class="category-name">Shopping</h6>
                                        <p class="category-description">Clothing, electronics, misc</p>
                                    </div>
                                </div>
                                <div class="budget-amounts">
                                    <div class="spent-amount">$450</div>
                                    <div class="budget-limit">/ $400</div>
                                </div>
                            </div>
                            <div class="budget-progress-bar">
                                <div class="progress">
                                    <div class="progress-bar bg-danger" style="width: 100%"></div>
                                </div>
                                <div class="progress-info">
                                    <span class="progress-percentage">112%</span>
                                    <span class="remaining-amount text-danger">$50 over budget</span>
                                </div>
                            </div>
                        </div>

                        <!-- Budget Item -->
                        <div class="budget-item">
                            <div class="budget-item-header">
                                <div class="budget-category">
                                    <div class="category-icon bg-info">
                                        <i class="fas fa-film"></i>
                                    </div>
                                    <div class="category-info">
                                        <h6 class="category-name">Entertainment</h6>
                                        <p class="category-description">Movies, games, subscriptions</p>
                                    </div>
                                </div>
                                <div class="budget-amounts">
                                    <div class="spent-amount">$85</div>
                                    <div class="budget-limit">/ $150</div>
                                </div>
                            </div>
                            <div class="budget-progress-bar">
                                <div class="progress">
                                    <div class="progress-bar bg-success" style="width: 57%"></div>
                                </div>
                                <div class="progress-info">
                                    <span class="progress-percentage">57%</span>
                                    <span class="remaining-amount">$65 remaining</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-4">
                <div class="card budget-tips-card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-lightbulb me-2"></i>Budget Tips
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="tip-item">
                            <div class="tip-icon bg-success">
                                <i class="fas fa-check"></i>
                            </div>
                            <div class="tip-content">
                                <h6>50/30/20 Rule</h6>
                                <p>Allocate 50% for needs, 30% for wants, and 20% for savings.</p>
                            </div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-icon bg-info">
                                <i class="fas fa-calendar"></i>
                            </div>
                            <div class="tip-content">
                                <h6>Weekly Check-ins</h6>
                                <p>Review your spending weekly to stay on track with your budgets.</p>
                            </div>
                        </div>
                        
                        <div class="tip-item">
                            <div class="tip-icon bg-warning">
                                <i class="fas fa-bell"></i>
                            </div>
                            <div class="tip-content">
                                <h6>Set Alerts</h6>
                                <p>Get notified when you reach 80% of any budget category.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card budget-chart-card mt-4">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-chart-pie me-2"></i>Budget Distribution
                        </h5>
                    </div>
                    <div class="card-body">
                        <canvas id="budgetDistributionChart" height="250"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create Budget Modal -->
<div class="modal fade" id="createBudgetModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-plus me-2"></i>Create New Budget
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="createBudgetForm">
                    <div class="mb-3">
                        <label for="budgetCategory" class="form-label">Category</label>
                        <select class="form-select" id="budgetCategory" required>
                            <option value="">Select a category</option>
                            <option value="Food and Drink">Food & Dining</option>
                            <option value="Transportation">Transportation</option>
                            <option value="Shopping">Shopping</option>
                            <option value="Entertainment">Entertainment</option>
                            <option value="Bills">Bills & Utilities</option>
                            <option value="Health">Health & Fitness</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="budgetAmount" class="form-label">Monthly Limit</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" class="form-control" id="budgetAmount" step="0.01" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="budgetDescription" class="form-label">Description (Optional)</label>
                        <textarea class="form-control" id="budgetDescription" rows="3" placeholder="Add notes about this budget..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="createBudget()">Create Budget</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    initializeBudgetChart();
});

function initializeBudgetChart() {
    const ctx = document.getElementById('budgetDistributionChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Food & Dining', 'Transportation', 'Shopping', 'Entertainment', 'Bills'],
            datasets: [{
                data: [600, 300, 400, 150, 800],
                backgroundColor: [
                    '#EF4444',
                    '#3B82F6',
                    '#10B981',
                    '#06B6D4',
                    '#8B5CF6'
                ]
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true
                    }
                }
            }
        }
    });
}

function createBudget() {
    const category = document.getElementById('budgetCategory').value;
    const amount = document.getElementById('budgetAmount').value;
    const description = document.getElementById('budgetDescription').value;
    
    if (!category || !amount) {
        alert('Please fill in all required fields');
        return;
    }
    
    fetch('/api/budget', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            category: category,
            monthly_limit: amount,
            description: description
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            bootstrap.Modal.getInstance(document.getElementById('createBudgetModal')).hide();
            location.reload();
        } else {
            alert('Error creating budget: ' + data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error creating budget');
    });
}
</script>
{% endblock %}